@page "/car-tool"

@inject ICarsData carsData

<ToolHeader HeaderText="Car Tool" />

<CarTable Cars="@cars" EditCarId="@editCarId"
  OnEditCar="doEditCar" OnDeleteCar="doConfirmDeleteCar"
  OnSaveCar="doSaveCar" OnCancelCar="doCancelCar" />

<CarForm ButtonText="Add Car" OnSubmitForm="doAddCar" />

<TelerikDialog @bind-Visible="@showConfirmDeleteCar" Title="Confirm Delete" CloseOnOverlayClick="false">
  <DialogContent>
    Are you sure you want to delete the car?
  </DialogContent>
  <DialogButtons>
    <TelerikButton OnClick="doDeleteCar">Yes</TelerikButton>
    <TelerikButton OnClick="doCancelDeleteCar">No</TelerikButton>
  </DialogButtons>
</TelerikDialog>

@code {

  private bool showConfirmDeleteCar { get; set; } = false;

  private IEnumerable<ICar> cars = new List<ICar>();

  private int editCarId = -1;
  private int pendingDeleteCarId = -1;

  protected async override Task OnParametersSetAsync()
  {
    cars = await carsData.All();
  }

  private void doEditCar(int carId)
  {
    editCarId = carId;
  }

  private void doCancelCar()
  {
    editCarId = -1;
  }

  private async Task doAddCar(INewCar car) {
    await carsData.Append(car);
    cars = await carsData.All();
    editCarId = -1;
  }

  private async Task doSaveCar(ICar car)
  {
    await carsData.Replace(car);
    cars = await carsData.All();
    editCarId = -1;
  }

  private void doConfirmDeleteCar(int carId) {
    showConfirmDeleteCar = true;
    pendingDeleteCarId = carId;
  }

  private async Task doDeleteCar() {
    await carsData.Remove(pendingDeleteCarId);
    cars = await carsData.All();
    editCarId = -1;
    doCloseConfirmDeleteCar();
  }

  private void doCancelDeleteCar() {
    doCloseConfirmDeleteCar();
  }

  private void doCloseConfirmDeleteCar() {
    showConfirmDeleteCar = false;
    pendingDeleteCarId = -1;
  }

}
